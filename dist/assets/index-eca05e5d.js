import{F as o,r as t,j as e,B as x,T as K,I as j,q as y,g as d,h as b,i as L}from"./index-f1df9dd1.js";import{u as z}from"./useQuery-c68bb92b.js";import{u as A}from"./useMutation-25ca7f63.js";import{d as Q,u as E,a as M,f as k,b as P}from"./actions-694c9e21.js";import{D as R,T as U}from"./index-73ef1b5c.js";import{A as w}from"./index-1545cbfb.js";const V=()=>{const[f]=o.useForm(),[i,m]=t.useState(null),[r,c]=t.useState(null),[F,l]=t.useState(null),[v,h]=t.useState(!1),[p,_]=t.useState(null),{data:u,isPending:C}=z({queryKey:["headers"],queryFn:P,refetchOnWindowFocus:!1}),I=A({mutationFn:a=>Q(a)}),q=async a=>{await I.mutateAsync(a.id),y.invalidateQueries({queryKey:["headers"]})},D=async()=>{if(i&&r){const a=new FormData;a.append("header_image",i),a.append("header_image_mobile",r);const s=await E(p.id,a);y.invalidateQueries({queryKey:["headers"]}),n(),console.log(s,"res")}else return alert("Upload both mobile and desktop images!")},N=async()=>{if(i&&r){const a=new FormData;a.append("header_image",i),a.append("header_image_mobile",r);const s=await M(a);y.invalidateQueries({queryKey:["headers"]}),n(),console.log(s,"res")}else return alert("Upload both mobile and desktop images!")},S=async a=>{const s=await k(a.target.files[0]);m(a.target.files[0]),l(g=>({...g,img:s}))},T=async a=>{const s=await k(a.target.files[0]);c(a.target.files[0]),l(g=>({...g,mobile:s}))},n=()=>{m(null),c(null),l(null),h(!1),_(null),f.resetFields()},H=[{title:"Фото",dataIndex:"haeder_image_link",key:"haeder_image_link",render:a=>e.jsx(w,{src:d+""+a,size:80,shape:"square",style:{boxShadow:"0 0 10px 1px lightgrey"}})},{title:"Фото (Мобиль)",dataIndex:"haeder_image_mobile_link",key:"haeder_image_mobile_link",render:a=>e.jsx(w,{src:d+""+a,size:80,shape:"square",style:{boxShadow:"0 0 10px 1px lightgrey"}})},{title:"Дата создания",dataIndex:"create_data",key:"create_data",flex:1,align:"center"},{title:"Дейтсвия",dataIndex:"action",key:"action",flex:1,align:"center",render:(a,s)=>e.jsxs("div",{className:"d-flex align-center justify-center gap-x-1",children:[e.jsx(b,{title:"Изменить",placement:"top",children:e.jsx(L,{cursor:"pointer",size:20,color:"#252525",onClick:()=>{h(!0),_(s),m(s.haeder_image_link),c(s.haeder_image_mobile_link),l({img:d+""+s.haeder_image_link,mobile:d+""+s.haeder_image_mobile_link})}})}),e.jsx(b,{title:"Удалить",placement:"top",children:e.jsx(U,{cursor:"pointer",size:20,color:"#252525",onClick:()=>q(s)})})]})}];return e.jsxs("main",{className:"headers",children:[e.jsx("h1",{children:"Headers"}),e.jsxs("div",{className:"headers-table m-t-2",children:[e.jsx("div",{className:"w-100 d-flex align-center justify-end",children:e.jsx(x,{className:"m-y-1",type:"primary",onClick:()=>h(!0),children:"Создать +"})}),e.jsx(K,{loading:C,column:H,row:u==null?void 0:u.map(a=>({...a,key:a.id}))})]}),e.jsx(R,{history:{record:p,open:v,closeDrawer:n,preview:F,title:"Добавить",footer:e.jsxs("div",{className:"d-flex align-center gap-x-2",children:[e.jsx(x,{type:"primary",form:"history-form",htmlType:"submit",children:"Сохранить"}),e.jsx(x,{danger:!0,onClick:n,children:"Отмена"})]})},children:e.jsxs(o,{typeof:"form-data",onFinish:p?D:N,form:f,id:"history-form",layout:"vertical",children:[e.jsx(o.Item,{name:"image",label:e.jsxs("p",{children:["Картинка -",e.jsx("span",{style:{color:"red"},children:"1920X400 пикс"})]}),htmlFor:"image",children:e.jsx(j,{type:"file",onChange:S,id:"image"})}),e.jsx(o.Item,{name:"mobile_img",label:e.jsxs("p",{children:["Картинка(Мобильный) -",e.jsx("span",{style:{color:"red"},children:"768X340 пикс"})]}),htmlFor:"mobile_img",children:e.jsx(j,{type:"file",onChange:T,id:"mobile_img"})})]})})]})};export{V as default};
